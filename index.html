<!DOCTYPE html>
<!-- إضافة صفحة إنشاء حساب قبل الجدول -->
<div id="signupPage" style="position:fixed;top:0;left:0;width:100%;height:100%;background:#fff;z-index:9999;display:flex;justify-content:center;align-items:center;direction:rtl;text-align:right;">
  <div style="width:300px;background:#f8f8f8;padding:25px;border-radius:10px;box-shadow:0 0 10px #999;">
      <h2 style="text-align:center;">إنشاء حساب</h2>
      <label>اسم المستخدم</label>
      <input id="regUser" type="text" style="width:100%;padding:8px;margin-bottom:10px;">
      <label>كلمة المرور</label>
      <input id="regPass" type="password" style="width:100%;padding:8px;margin-bottom:20px;">
      <button onclick="createAccount()" style="width:100%;padding:10px;background:#4caf50;color:#fff;border:none;border-radius:6px;cursor:pointer;">إنشاء حساب</button>
  </div>
</div>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Weekly planner by hussien islam -تمت صناعة ب حسين أسلأم   الجدول الاسبوعي </title>
<style>
 body {font-family: sans-serif; background:#f5f5f5; direction:rtl; padding:20px; text-align:center;}
 h1{margin-bottom:20px;}
 .controls{margin-bottom:20px;}
 button{padding:10px 18px;margin:5px;font-size:16px;border:none;border-radius:6px;cursor:pointer;color:#fff}
 .add-week{background:#673ab7;} .print{background:#2196f3;} .pdf{background:#009688;} .add-task{background:#4caf50;} .reset{background:#e91e63;}
 table{width:100%;border-collapse:collapse;background:#fff;box-shadow:0 0 8px #999;margin-top:20px;}
 th,td{border:1px solid #ccc;padding:10px;vertical-align:top;}
 th{background:#2196f3;color:#fff;}
 .day-box{position:relative;}
 .task{background:#e3f2fd;padding:6px;margin:5px 0;border-radius:5px;text-align:right;}
 .task-time{font-size:13px;color:#333;}
 .remove{float:left;color:red;cursor:pointer;}
 textarea{width:100%;border:none;resize:none;outline:none;padding:6px;}
 .task-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);justify-content:center;align-items:center;}
 .modal-box{background:#fff;padding:20px;border-radius:10px;width:300px;}
 label{display:block;margin:10px 0 5px;}
 input,select{width:100%;padding:8px;margin-bottom:10px;}
</style>
</head>
<body>
<h1>اWeekly Planner - الجدول الاسبوعي</h1>
<div class="controls">
 <button class="add-week" onclick="addWeek()">إضافة أسبوع</button>
 <button class="print" onclick="window.print()">طباعة / PDF</button>
 <button class="pdf" onclick="generatePDF()">حفظ كملف PDF</button>
 <button class="reset" onclick="resetAll()">إعادة تعيين</button>
</div>
<div id="weeks"></div>
<div class="task-modal" id="taskModal">
 <div class="modal-box">
     <h3>إضافة مهمة</h3>
     <label>اليوم</label>
     <select id="daySelect"></select>
     <label>الساعة</label>
     <input type="time" id="taskTime">
     <label>المهمة</label>
     <input type="text" id="taskText">
     <button style="background:#4caf50;width:100%" onclick="saveTask()">حفظ</button>
 </div>
</div>
<script>
// إنشاء حساب
function createAccount(){
 let u=document.getElementById('regUser').value;
 let p=document.getElementById('regPass').value;
 if(u.trim()==='' || p.trim()==='') return alert('املأ جميع البيانات');
 localStorage.setItem('appUser',u);
 localStorage.setItem('appPass',p);
 document.getElementById('signupPage').style.display='none';
}
// عرض صفحة التسجيل أول مرة فقط
window.onload=function(){
 if(!localStorage.getItem('appUser')){
   document.getElementById('signupPage').style.display='flex';
 }
};
let weekCount=0;
function addWeek(){ weekCount++; let id="week"+weekCount;
 let days=["السبت","الأحد","الاثنين","الثلاثاء","الأربعاء","الخميس","الجمعة"];
 let html=`<table id="${id}"><tr><th>اليوم</th><th>المهام</th><th>إضافة</th></tr>`;
 days.forEach(d=>{ html+=`<tr><td>${d}</td><td class='day-box' id='${id}_${d}'></td><td><button class='add-task' onclick=\"openModal('${id}','${d}')\">+</button></td></tr>`;});
 html+=`</table>`;
 document.getElementById("weeks").innerHTML+=html;
 saveAll();}
function openModal(week,day){ document.getElementById("taskModal").style.display="flex";
 document.getElementById("daySelect").innerHTML=`<option value='${week}_${day}'>${week} - ${day}</option>`;}
function saveTask(){ let target=document.getElementById("daySelect").value;
 let time=document.getElementById("taskTime").value;
 let text=document.getElementById("taskText").value;
 if(!time||!text)return; let box=document.getElementById(target);
 box.innerHTML+=`<div class='task'><span class='remove' onclick='this.parentElement.remove();saveAll()'>✖</span><div class='task-time'>${time}</div>${text}</div>`;
 scheduleNotification(time,text);
 closeModal(); saveAll();}
function closeModal(){ document.getElementById("taskModal").style.display="none"; document.getElementById("taskText").value="";}
document.getElementById("taskModal").onclick=e=>{if(e.target.id=="taskModal")closeModal()};
function saveAll(){ localStorage.setItem("weeksData",document.getElementById("weeks").innerHTML); }
function loadAll(){
 let d=localStorage.getItem("weeksData");
 if(d) document.getElementById("weeks").innerHTML=d;
}
function resetAll(){ if(confirm("حذف كل الجداول؟")){ localStorage.removeItem("weeksData"); location.reload();}}
function generatePDF(){ window.print(); }
function scheduleNotification(time,text){ if(!('Notification' in window)) return;
 Notification.requestPermission().then(p=>{ if(p==='granted'){
 let now=new Date(); let t=new Date(now.toDateString()+" "+time);
 let diff=t-now; if(diff>0){ setTimeout(()=>{ new Notification("تذكير مهمة",{ body:text }); }, diff);} }});
}
loadAll(); attachEvents();
function attachEvents(){
 document.querySelectorAll('.add-task').forEach(btn=>{
   let data=btn.getAttribute('onclick');
   btn.setAttribute('onclick', data);
 });
 document.querySelectorAll('.remove').forEach(r=>{
   r.onclick=function(){ this.parentElement.remove(); saveAll(); };
 });
}
</script>
</body>
</html>
